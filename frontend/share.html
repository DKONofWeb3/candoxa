<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Candoxa — Share a Link</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Inter", system-ui, sans-serif;
        background: linear-gradient(to bottom, #030514, #050819);
        color: white;
      }

      .frosted {
        background: rgba(10, 13, 24, 0.7);
        backdrop-filter: blur(8px);
      }

      .navbar-scroll {
        background-color: rgba(3, 5, 20, 0.8);
        backdrop-filter: blur(8px);
      }

      .tooltip {
        position: absolute;
        background: rgba(10, 13, 24, 0.9);
        color: #b4b6bd;
        font-size: 0.85rem;
        padding: 0.5rem 0.75rem;
        border-radius: 6px;
        border: 1px solid #0e1324;
        transform: translateY(-110%);
        opacity: 0;
        transition: opacity 0.2s ease;
        white-space: nowrap;
      }

      .tooltip.show {
        opacity: 1;
      }
    </style>
  </head>

  <body class="overflow-x-hidden">
    <!-- Navbar -->
    <nav
      id="navbar"
      class="fixed top-0 w-full z-50 transition-all duration-500 bg-transparent"
    >
      <div class="max-w-6xl mx-auto flex justify-between items-center py-5 px-6">
        <div class="font-medium text-lg">Candoxa</div>
      <!-- Desktop nav -->
<div class="hidden md:flex space-x-8 text-sm items-center">
  <a href="feed.html" class="text-[#2563eb]">Feed</a>
  <a href="profile.html" class="hover:text-[#2563eb]">Profile</a>
  <a href="leaderboard.html" class="hover:text-[#2563eb]">Leaderboard</a>
  <a
    href="share.html"
    class="border border-white/30 px-4 py-2 rounded-md hover:bg-white/10 transition"
  >
    Share
  </a>
  <button
    id="logout-btn"
    class="text-sm text-gray-400 hover:text-red-400 transition"
  >
    Log out
  </button>
</div>

<!-- Mobile hamburger -->
<button
  id="menu-btn"
  class="md:hidden text-white focus:outline-none"
>
  ☰
</button>
      </div>
    </nav>
<div
  id="mobile-menu"
  class="hidden fixed top-20 left-0 w-full bg-[#030514] border-t border-white/10 z-40"
>
  <div class="flex flex-col px-6 py-4 space-y-4 text-sm">
    <a href="feed.html">Feed</a>
    <a href="profile.html">Profile</a>
    <a href="leaderboard.html">Leaderboard</a>
    <a href="share.html">Share</a>
    <button
      id="mobile-logout-btn"
      class="text-left text-red-400"
    >
      Log out
    </button>
  </div>
</div>

    <!-- Share Section -->
    <main class="pt-32 pb-20 px-6 max-w-lg mx-auto text-center">
      <h1 class="text-3xl font-medium mb-4">Share a Discovery</h1>
      <p class="text-gray-400 text-sm mb-10">
        Contribute meaningful content for others to explore.
      </p>

      <form id="share-form" class="frosted rounded-2xl p-8 space-y-5 relative">
        <input
          id="url"
          type="url"
          placeholder="Paste a content URL"
          class="w-full bg-[#050812] text-white rounded-md px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
          required
        />

        <select
          id="platform"
          class="w-full bg-[#050812] text-white rounded-md px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
          required
        >
          <option value="">Select platform</option>
          <option value="linkedin">LinkedIn</option>
          <option value="x">X (Twitter)</option>
          <option value="tiktok">TikTok</option>
          <option value="other">Other</option>
        </select>

        <textarea
          id="description"
          rows="4"
          placeholder="Short description (optional)"
          class="w-full bg-[#050812] text-white rounded-md px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
        ></textarea>

        <div class="relative">
          <button
            id="submit-btn"
            type="submit"
            disabled
            class="w-full bg-[#2563eb]/50 text-white font-medium rounded-md px-6 py-3 cursor-not-allowed"
          >
            Share Discovery
          </button>
          <div id="tooltip" class="tooltip">
            Earn more points to unlock sharing
          </div>
        </div>
      </form>
    </main>

    <footer class="py-10 text-center text-gray-500 text-sm">
      © 2026 Candoxa. All rights reserved.
    </footer>

    <!-- Script -->
<script type="module">
  import { requireAuth } from "./assets/js/guard.js";
  import { api } from "./assets/js/api.js";

  // Ensure user is authenticated
  await requireAuth();

  // Navbar scroll effect
  window.addEventListener("scroll", () => {
    document
      .getElementById("navbar")
      .classList.toggle("navbar-scroll", window.scrollY > 50);
  });

  const form = document.getElementById("share-form");
  const submitBtn = document.getElementById("submit-btn");
  const tooltip = document.getElementById("tooltip");

  /* ---------------- MOBILE MENU ---------------- */
  const menuBtn = document.getElementById("menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");

  // open / close menu
  menuBtn?.addEventListener("click", () => {
    mobileMenu.classList.toggle("hidden");
  });

  // close menu after clicking a link or logout
  mobileMenu?.addEventListener("click", e => {
    if (e.target.tagName === "A" || e.target.tagName === "BUTTON") {
      mobileMenu.classList.add("hidden");
    }
  });

  /* ---------------- LOGOUT ---------------- */
  async function logout() {
    try {
      await api("/logout", { method: "POST" });
    } finally {
      window.location.href = "index.html";
    }
  }

  document.getElementById("logout-btn")?.addEventListener("click", logout);
  document
    .getElementById("mobile-logout-btn")
    ?.addEventListener("click", logout);

  async function loadUser() {
    const user = await api("/users/me");

    // Treat localhost as non-production
    const IS_PRODUCTION =
      location.hostname !== "localhost" &&
      !location.hostname.includes("vercel.app");

    const MIN_POINTS_TO_POST = IS_PRODUCTION ? 5 : 0;

    if (user.points >= MIN_POINTS_TO_POST) {
      submitBtn.disabled = false;
      submitBtn.classList.remove("cursor-not-allowed", "bg-[#2563eb]/50");
      submitBtn.classList.add("bg-[#2563eb]", "hover:bg-[#1e4fd1]");
      tooltip.textContent = "Ready to share";
    } else {
      submitBtn.disabled = true;
      tooltip.textContent = "Earn more points to unlock sharing";
    }
  }

  submitBtn.addEventListener("mouseenter", () => {
    if (submitBtn.disabled) tooltip.classList.add("show");
  });

  submitBtn.addEventListener("mouseleave", () => {
    tooltip.classList.remove("show");
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    if (submitBtn.disabled) return;

    submitBtn.disabled = true;
    submitBtn.textContent = "Sharing…";

    try {
      await api("/posts", {
        method: "POST",
        body: {
          url: document.getElementById("url").value.trim(),
          platform: document.getElementById("platform").value,
          description: document
            .getElementById("description")
            .value.trim(),
        },
      });

      window.location.href = "/feed.html";
    } catch (err) {
      alert(err.message || "Failed to share");
      submitBtn.disabled = false;
      submitBtn.textContent = "Share Discovery";
    }
  });

  loadUser();
</script>


  </body>
</html>
