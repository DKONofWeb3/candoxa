<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Candoxa — Profile</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Inter", system-ui, sans-serif;
        background: linear-gradient(to bottom, #030514, #050819);
        color: white;
      }

      .frosted {
        background: rgba(10, 13, 24, 0.7);
        backdrop-filter: blur(8px);
      }

      .navbar-scroll {
        background-color: rgba(3, 5, 20, 0.8);
        backdrop-filter: blur(8px);
      }

      .feed-card:hover {
        transform: translateY(-3px) scale(1.01);
        transition: transform 0.2s ease;
      }
    </style>
  </head>

  <body class="overflow-x-hidden">
    <!-- Navbar -->
    <nav
      id="navbar"
      class="fixed top-0 w-full z-50 transition-all duration-500 bg-transparent"
    >
      <div class="max-w-6xl mx-auto flex justify-between items-center py-5 px-6">
        <div class="font-medium text-lg">Candoxa</div>
        <div class="flex space-x-8 text-sm">
          <a href="feed.html" class="hover:text-[#2563eb]">Feed</a>
          <a href="profile.html" class="text-[#2563eb]">Profile</a>
          <a href="leaderboard.html" class="hover:text-[#2563eb]">Leaderboard</a>
          <a
            href="share.html"
            class="border border-white/30 px-4 py-2 rounded-md hover:bg-white/10 transition"
            >Share</a
          >
<button
  id="logout-btn"
  class="text-sm text-gray-400 hover:text-red-400 transition"
>
  Log out
</button>
        </div>
      </div>
    </nav>

    <!-- Profile -->
    <main class="pt-32 pb-20 px-6 max-w-6xl mx-auto grid md:grid-cols-3 gap-10">
      <!-- Left -->
      <aside class="frosted rounded-2xl p-8 flex flex-col items-center text-center">
        <img
          id="avatar"
          class="w-24 h-24 rounded-full mb-4"
          alt="User avatar"
        />

        <h2 id="display-name" class="text-xl font-medium mb-1"></h2>
        <p id="username" class="text-gray-400 text-sm mb-4"></p>

        <div class="bg-[#050812] rounded-md py-2 px-4 text-sm text-gray-300">
          Total Points:
          <span id="points" class="text-[#2563eb] font-medium"></span>
        </div>

        <div class="mt-8 text-sm text-gray-400 space-y-2">
          <p>Joined: <span id="joined"></span></p>
          <p>Discoveries shared: <span id="discoveries"></span></p>
          <p>Saved posts: <span id="saved"></span></p>
        </div>
      </aside>

      <!-- Right -->
      <section class="md:col-span-2">
        <h1 class="text-2xl font-medium mb-6">Recent Activity</h1>
        <div id="activity-feed" class="space-y-6 text-sm text-gray-400">
          Loading activity…
        </div>
      </section>
    </main>

    <footer class="py-10 text-center text-gray-500 text-sm">
      © 2026 Candoxa. All rights reserved.
    </footer>

    <!-- Script -->
    <script type="module">
  import { requireAuth } from "./assets/js/guard.js";
  import { api } from "./assets/js/api.js";

  await requireAuth();

  window.addEventListener("scroll", () => {
    document
      .getElementById("navbar")
      .classList.toggle("navbar-scroll", window.scrollY > 50);
  });

  function renderActivity(item) {
    const labels = {
      click: "You opened a discovery",
      like: "You liked a discovery",
      save: "You saved a discovery",
    };

    return `
      <div class="feed-card frosted rounded-xl p-6">
        <p class="text-xs text-gray-500 mb-2">
          ${labels[item.type] || "You interacted"}
        </p>
        <p class="text-gray-400">${item.description}</p>
      </div>
    `;
  }

  async function loadProfile() {
    const user = await api("/users/me");

    document.getElementById("avatar").src =
      user.avatar_url || "https://source.unsplash.com/100x100/?portrait";

    document.getElementById("display-name").textContent =
      user.display_name || user.username;

    document.getElementById("username").textContent = "@" + user.username;
    document.getElementById("points").textContent = user.points;

    document.getElementById("joined").textContent =
      new Date(user.joined_at).toLocaleDateString("en-US", {
        month: "short",
        year: "numeric",
      });

    document.getElementById("discoveries").textContent = user.discoveries;
    document.getElementById("saved").textContent = user.saved;

    const activity = await api("/users/me/activity");
    const container = document.getElementById("activity-feed");
    container.innerHTML = "";

    if (!activity.length) {
      container.innerHTML =
        '<p class="text-gray-500 text-sm">No activity yet.</p>';
      return;
    }

    activity.forEach(item =>
      container.insertAdjacentHTML("beforeend", renderActivity(item))
    );
  }

  loadProfile();
</script>

  </body>
</html>
